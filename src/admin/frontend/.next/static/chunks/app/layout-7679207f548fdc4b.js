(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8902:function(e,t,r){Promise.resolve().then(r.bind(r,2114)),Promise.resolve().then(r.t.bind(r,9268,23))},2114:function(e,t,r){"use strict";r.d(t,{default:function(){return i}});var n=r(7437),o=r(4540),a=r(9064);function i(e){let{children:t}=e;return(0,n.jsxs)(o.W,{children:[t,(0,n.jsx)(a.x7,{position:"top-center",reverseOrder:!1,gutter:8,containerClassName:"",containerStyle:{},toastOptions:{className:"",duration:4e3,style:{background:"#363636",color:"#fff",direction:"rtl",fontFamily:"Vazirmatn, Inter, sans-serif"},success:{duration:3e3,style:{background:"#10B981"}},error:{duration:5e3,style:{background:"#EF4444"}},loading:{style:{background:"#3B82F6"}}}})]})}},4540:function(e,t,r){"use strict";r.d(t,{J3:function(){return l},W:function(){return u},c2:function(){return c}});var n=r(7437),o=r(2265),a=r(9376),i=r(4300);let s=(0,o.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0),[d,f]=(0,o.useState)(null),m=(0,a.useRouter)(),g=(0,o.useCallback)(async()=>{try{if(c(!0),!i.KE()){u(null),c(!1);return}if(!await i.Wg()){i.w3(),u(null),c(!1);return}let e=await i.T();u(e),i.ZM(e,!0)}catch(e){console.error("Admin auth check failed:",e),i.w3(),u(null)}finally{c(!1)}},[]),E=(0,o.useCallback)(async e=>{try{c(!0),f(null);let t=await i.$g(e);if(t.success)u(t.data.user),m.push("/admin/dashboard");else throw Error(t.message||"Login failed")}catch(e){throw console.error("Admin login error:",e),f(e.message||"Login failed"),e}finally{c(!1)}},[m]),h=(0,o.useCallback)(async()=>{try{c(!0),await i.rE()}catch(e){console.error("Admin logout error:",e)}finally{u(null),i.w3(),c(!1),m.push("/admin/login")}},[m]),A=(0,o.useCallback)(()=>{f(null)},[]),v=(0,o.useCallback)(e=>i.CI(r,e),[r]),N=(0,o.useCallback)(e=>i.Aw(r,e),[r]);return(0,o.useEffect)(()=>{g()},[g]),(0,o.useEffect)(()=>{if(!r)return;let e=i.KE();if(e)try{let t=JSON.parse(atob(e.split(".")[1])),r=1e3*t.exp,n=Date.now(),o=r-n;o>0&&o<3e5&&(console.log("Admin token expiring soon, refreshing..."),g())}catch(e){console.error("Error parsing admin token:",e)}},[r,g]),(0,n.jsx)(s.Provider,{value:{user:r,loading:l,error:d,login:E,logout:h,clearError:A,hasRole:v,hasAnyRole:N,isAuthenticated:!!r},children:t})}function l(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAdminAuth must be used within an AdminAuthProvider");return e}function c(e,t){return function(r){let{user:i,loading:s,hasRole:u}=l(),c=(0,a.useRouter)();return((0,o.useEffect)(()=>{if(!s){if(!i){c.push("/admin/login");return}if(t&&!u(t)){c.push("/admin/unauthorized");return}}},[i,s,u,c]),s)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):i&&(!t||u(t))?(0,n.jsx)(e,{...r}):null}}},4300:function(e,t,r){"use strict";r.d(t,{$g:function(){return A},rE:function(){return v},w3:function(){return E},ZP:function(){return y},T:function(){return N},KE:function(){return m},CI:function(){return S},Aw:function(){return I},ZM:function(){return h},Wg:function(){return p}});var n,o,a,i,s,u,l,c,d=r(3464);(n=s||(s={})).SUPER_ADMIN="SUPER_ADMIN",n.PLATFORM_ADMIN="PLATFORM_ADMIN",n.SUPPORT="SUPPORT",n.DEVELOPER="DEVELOPER",(o=u||(u={})).HEALTHY="HEALTHY",o.WARNING="WARNING",o.CRITICAL="CRITICAL",o.MAINTENANCE="MAINTENANCE",(a=l||(l={})).ACTIVE="ACTIVE",a.SUSPENDED="SUSPENDED",a.PENDING="PENDING",a.CANCELLED="CANCELLED",(i=c||(c={})).STARTER="STARTER",i.BUSINESS="BUSINESS",i.ENTERPRISE="ENTERPRISE";let f=d.Z.create({baseURL:"http://localhost:3003/api",timeout:1e4,headers:{"Content-Type":"application/json"}});f.interceptors.request.use(e=>{let t=m();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),f.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(E(),window.location.href="/admin/login"),Promise.reject(e)});let m=()=>{let e=localStorage.getItem("admin_token"),t=sessionStorage.getItem("admin_token");return e||t},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?localStorage.setItem("admin_token",e):sessionStorage.setItem("admin_token",e)},E=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_user"),delete f.defaults.headers.common.Authorization},h=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=JSON.stringify(e);t?localStorage.setItem("admin_user",r):sessionStorage.setItem("admin_user",r)},A=async e=>{try{let t=(await f.post("/admin/auth/login",e)).data;if(t.success){let{user:e,token:r}=t.data;return g(r,!0),h(e,!0),f.defaults.headers.common.Authorization="Bearer ".concat(r),{success:!0,message:t.message,data:{user:e,token:r}}}throw Error(t.message||"Login failed")}catch(e){var t,r;throw console.error("Admin login error:",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||e.message||"Login failed")}},v=async()=>{try{m()&&await f.post("/admin/auth/logout")}catch(e){console.error("Admin logout error:",e)}finally{E()}},N=async()=>{try{return(await f.get("/admin/auth/profile")).data.data}catch(r){var e,t;throw console.error("Get admin profile error:",r),Error((null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||r.message||"Failed to get profile")}},p=async()=>{try{return(await f.get("/admin/auth/verify")).data.success}catch(e){return console.error("Admin token verification failed:",e),!1}},S=(e,t)=>!!e&&e.role===t,I=(e,t)=>!!e&&t.includes(e.role);var y=f},9268:function(){}},function(e){e.O(0,[825,301,64,971,117,744],function(){return e(e.s=8902)}),_N_E=e.O()}]);
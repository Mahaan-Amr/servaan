(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[585],{4828:function(e,t,r){Promise.resolve().then(r.bind(r,4361))},4361:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(7437),s=r(4540),a=r(2265);function o(){let{user:e,loading:t,isAuthenticated:r,error:o}=(0,s.J3)(),[i,l]=(0,a.useState)({});return(0,a.useEffect)(()=>{{let e=localStorage.getItem("admin_token")||sessionStorage.getItem("admin_token"),t=localStorage.getItem("admin_user")||sessionStorage.getItem("admin_user");l({token:e?"".concat(e.substring(0,20),"..."):"No token",userData:t?JSON.parse(t):"No user data",hasToken:!!e,hasUserData:!!t})}},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-admin-bg p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-admin-text mb-6",children:"Authentication Debug"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"bg-white p-6 rounded-admin border border-admin-border",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-admin-text mb-4",children:"Context State"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Loading:"})," ",t?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Is Authenticated:"})," ",r?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User:"})," ",e?JSON.stringify(e,null,2):"No user"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Error:"})," ",o||"No error"]})]})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-admin border border-admin-border",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-admin-text mb-4",children:"Local Storage"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Has Token:"})," ",i.hasToken?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Has User Data:"})," ",i.hasUserData?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Token:"})," ",i.token]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Data:"})," ",(0,n.jsx)("pre",{className:"text-xs",children:JSON.stringify(i.userData,null,2)})]})]})]})]}),(0,n.jsxs)("div",{className:"mt-6 bg-white p-6 rounded-admin border border-admin-border",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-admin-text mb-4",children:"Actions"}),(0,n.jsxs)("div",{className:"space-x-4",children:[(0,n.jsx)("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},className:"btn-admin-danger",children:"Clear All Storage"}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"btn-admin-secondary",children:"Reload Page"})]})]})]})}},4540:function(e,t,r){"use strict";r.d(t,{J3:function(){return d},W:function(){return l},c2:function(){return c}});var n=r(7437),s=r(2265),a=r(9376),o=r(4300);let i=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),h=(0,a.useRouter)(),g=(0,s.useCallback)(async()=>{try{if(c(!0),!o.KE()){l(null),c(!1);return}if(!await o.Wg()){o.w3(),l(null),c(!1);return}let e=await o.T();l(e),o.ZM(e,!0)}catch(e){console.error("Admin auth check failed:",e),o.w3(),l(null)}finally{c(!1)}},[]),f=(0,s.useCallback)(async e=>{try{c(!0),m(null);let t=await o.$g(e);if(t.success)l(t.data.user),h.push("/admin/dashboard");else throw Error(t.message||"Login failed")}catch(e){throw console.error("Admin login error:",e),m(e.message||"Login failed"),e}finally{c(!1)}},[h]),x=(0,s.useCallback)(async()=>{try{c(!0),await o.rE()}catch(e){console.error("Admin logout error:",e)}finally{l(null),o.w3(),c(!1),h.push("/admin/login")}},[h]),N=(0,s.useCallback)(()=>{m(null)},[]),E=(0,s.useCallback)(e=>o.CI(r,e),[r]),v=(0,s.useCallback)(e=>o.Aw(r,e),[r]);return(0,s.useEffect)(()=>{g()},[g]),(0,s.useEffect)(()=>{if(!r)return;let e=o.KE();if(e)try{let t=JSON.parse(atob(e.split(".")[1])),r=1e3*t.exp,n=Date.now(),s=r-n;s>0&&s<3e5&&(console.log("Admin token expiring soon, refreshing..."),g())}catch(e){console.error("Error parsing admin token:",e)}},[r,g]),(0,n.jsx)(i.Provider,{value:{user:r,loading:d,error:u,login:f,logout:x,clearError:N,hasRole:E,hasAnyRole:v,isAuthenticated:!!r},children:t})}function d(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAdminAuth must be used within an AdminAuthProvider");return e}function c(e,t){return function(r){let{user:o,loading:i,hasRole:l}=d(),c=(0,a.useRouter)();return((0,s.useEffect)(()=>{if(!i){if(!o){c.push("/admin/login");return}if(t&&!l(t)){c.push("/admin/unauthorized");return}}},[o,i,l,c]),i)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):o&&(!t||l(t))?(0,n.jsx)(e,{...r}):null}}},4300:function(e,t,r){"use strict";r.d(t,{$g:function(){return N},rE:function(){return E},w3:function(){return f},ZP:function(){return p},T:function(){return v},KE:function(){return h},CI:function(){return b},Aw:function(){return A},ZM:function(){return x},Wg:function(){return S}});var n,s,a,o,i,l,d,c,u=r(3464);(n=i||(i={})).SUPER_ADMIN="SUPER_ADMIN",n.PLATFORM_ADMIN="PLATFORM_ADMIN",n.SUPPORT="SUPPORT",n.DEVELOPER="DEVELOPER",(s=l||(l={})).HEALTHY="HEALTHY",s.WARNING="WARNING",s.CRITICAL="CRITICAL",s.MAINTENANCE="MAINTENANCE",(a=d||(d={})).ACTIVE="ACTIVE",a.SUSPENDED="SUSPENDED",a.PENDING="PENDING",a.CANCELLED="CANCELLED",(o=c||(c={})).STARTER="STARTER",o.BUSINESS="BUSINESS",o.ENTERPRISE="ENTERPRISE";let m=u.Z.create({baseURL:"http://localhost:3003/api",timeout:1e4,headers:{"Content-Type":"application/json"}});m.interceptors.request.use(e=>{let t=h();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(f(),window.location.href="/admin/login"),Promise.reject(e)});let h=()=>{let e=localStorage.getItem("admin_token"),t=sessionStorage.getItem("admin_token");return e||t},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?localStorage.setItem("admin_token",e):sessionStorage.setItem("admin_token",e)},f=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_user"),delete m.defaults.headers.common.Authorization},x=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=JSON.stringify(e);t?localStorage.setItem("admin_user",r):sessionStorage.setItem("admin_user",r)},N=async e=>{try{let t=(await m.post("/admin/auth/login",e)).data;if(t.success){let{user:e,token:r}=t.data;return g(r,!0),x(e,!0),m.defaults.headers.common.Authorization="Bearer ".concat(r),{success:!0,message:t.message,data:{user:e,token:r}}}throw Error(t.message||"Login failed")}catch(e){var t,r;throw console.error("Admin login error:",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||e.message||"Login failed")}},E=async()=>{try{h()&&await m.post("/admin/auth/logout")}catch(e){console.error("Admin logout error:",e)}finally{f()}},v=async()=>{try{return(await m.get("/admin/auth/profile")).data.data}catch(r){var e,t;throw console.error("Get admin profile error:",r),Error((null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||r.message||"Failed to get profile")}},S=async()=>{try{return(await m.get("/admin/auth/verify")).data.success}catch(e){return console.error("Admin token verification failed:",e),!1}},b=(e,t)=>!!e&&e.role===t,A=(e,t)=>!!e&&t.includes(e.role);var p=m}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=4828)}),_N_E=e.O()}]);
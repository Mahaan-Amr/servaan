(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{7794:function(e,r,s){Promise.resolve().then(s.bind(s,438))},438:function(e,r,s){"use strict";s.d(r,{default:function(){return j}});var t=s(7437),n=s(2265),a=s(4540),l=s(4938),i=s(8420),o=s(5805),c=s(6215),d=s(8906),u=s(8728),m=s(5368),f=s(2489),h=s(8293),x=s(3247),g=s(4766),N=s(7692),p=s(7648),v=s(9376);let y=[{name:"Dashboard",href:"/admin/dashboard",icon:l.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN","SUPPORT","DEVELOPER"]},{name:"Tenants",href:"/admin/tenants",icon:i.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN"]},{name:"Users",href:"/admin/users",icon:o.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN","SUPPORT"]},{name:"Analytics",href:"/admin/analytics",icon:c.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN"]},{name:"Security",href:"/admin/security",icon:d.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN"]},{name:"System",href:"/admin/system",icon:u.Z,roles:["SUPER_ADMIN","DEVELOPER"]},{name:"Support",href:"/admin/support",icon:m.Z,roles:["SUPER_ADMIN","PLATFORM_ADMIN","SUPPORT"]}];function j(e){var r;let{children:s}=e,[l,i]=(0,n.useState)(!1),{user:o,logout:c,hasRole:u}=(0,a.J3)(),m=(0,v.usePathname)(),j=async()=>{try{await c()}catch(e){console.error("Logout error:",e)}},w=y.filter(e=>e.roles.some(e=>u(e)));return(0,t.jsxs)("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[l&&(0,t.jsxs)("div",{className:"fixed inset-0 flex z-40 md:hidden",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>i(!1)}),(0,t.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,t.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>i(!1),children:(0,t.jsx)(f.Z,{className:"h-6 w-6 text-white"})})}),(0,t.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex-shrink-0 flex items-center px-4",children:[(0,t.jsx)("div",{className:"h-8 w-8 bg-admin-primary rounded-lg flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"h-5 w-5 text-white"})}),(0,t.jsx)("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"Admin Panel"})]}),(0,t.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:w.map(e=>{let r=m===e.href;return(0,t.jsxs)(p.default,{href:e.href,className:"".concat(r?"bg-admin-primary text-white":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"," group flex items-center px-2 py-2 text-base font-medium rounded-md"),children:[(0,t.jsx)(e.icon,{className:"mr-4 h-6 w-6"}),e.name]},e.name)})})]})]})]}),(0,t.jsx)("div",{className:"hidden md:flex md:flex-shrink-0",children:(0,t.jsx)("div",{className:"flex flex-col w-64",children:(0,t.jsxs)("div",{className:"flex flex-col h-0 flex-1 border-r border-gray-200 bg-white",children:[(0,t.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center flex-shrink-0 px-4",children:[(0,t.jsx)("div",{className:"h-8 w-8 bg-admin-primary rounded-lg flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"h-5 w-5 text-white"})}),(0,t.jsx)("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"Admin Panel"})]}),(0,t.jsx)("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:w.map(e=>{let r=m===e.href;return(0,t.jsxs)(p.default,{href:e.href,className:"".concat(r?"bg-admin-primary text-white":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"," group flex items-center px-2 py-2 text-sm font-medium rounded-md"),children:[(0,t.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})})]}),(0,t.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("div",{className:"h-8 w-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:null==o?void 0:null===(r=o.email)||void 0===r?void 0:r.charAt(0).toUpperCase()})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700",children:null==o?void 0:o.email}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:null==o?void 0:o.role})]})]})})]})})}),(0,t.jsxs)("div",{className:"flex flex-col w-0 flex-1 overflow-hidden",children:[(0,t.jsxs)("div",{className:"relative z-10 flex-shrink-0 flex h-16 bg-white shadow",children:[(0,t.jsx)("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-admin-primary md:hidden",onClick:()=>i(!0),children:(0,t.jsx)(h.Z,{className:"h-6 w-6"})}),(0,t.jsxs)("div",{className:"flex-1 px-4 flex justify-between",children:[(0,t.jsx)("div",{className:"flex-1 flex",children:(0,t.jsxs)("form",{className:"w-full flex md:ml-0",action:"#",method:"GET",children:[(0,t.jsx)("label",{htmlFor:"search-field",className:"sr-only",children:"Search"}),(0,t.jsxs)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:(0,t.jsx)(x.Z,{className:"h-5 w-5"})}),(0,t.jsx)("input",{id:"search-field",className:"block w-full h-full pl-8 pr-3 py-2 border-transparent text-gray-900 placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-0 focus:border-transparent",placeholder:"Search...",type:"search",name:"search"})]})]})}),(0,t.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,t.jsx)("button",{type:"button",className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-admin-primary",children:(0,t.jsx)(g.Z,{className:"h-6 w-6"})}),(0,t.jsx)("div",{className:"ml-3 relative",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-700",children:[null==o?void 0:o.email," (",null==o?void 0:o.role,")"]}),(0,t.jsx)("button",{onClick:j,className:"bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-admin-primary",title:"Logout",children:(0,t.jsx)(N.Z,{className:"h-5 w-5"})})]})})]})]})]}),(0,t.jsx)("main",{className:"flex-1 relative overflow-y-auto focus:outline-none",children:(0,t.jsx)("div",{className:"py-6",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:s})})})]})]})}},4540:function(e,r,s){"use strict";s.d(r,{J3:function(){return c},W:function(){return o},c2:function(){return d}});var t=s(7437),n=s(2265),a=s(9376),l=s(4300);let i=(0,n.createContext)(void 0);function o(e){let{children:r}=e,[s,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),[u,m]=(0,n.useState)(null),f=(0,a.useRouter)(),h=(0,n.useCallback)(async()=>{try{if(d(!0),!l.KE()){o(null),d(!1);return}if(!await l.Wg()){l.w3(),o(null),d(!1);return}let e=await l.T();o(e),l.ZM(e,!0)}catch(e){console.error("Admin auth check failed:",e),l.w3(),o(null)}finally{d(!1)}},[]),x=(0,n.useCallback)(async e=>{try{d(!0),m(null);let r=await l.$g(e);if(r.success)o(r.data.user),f.push("/admin/dashboard");else throw Error(r.message||"Login failed")}catch(e){throw console.error("Admin login error:",e),m(e.message||"Login failed"),e}finally{d(!1)}},[f]),g=(0,n.useCallback)(async()=>{try{d(!0),await l.rE()}catch(e){console.error("Admin logout error:",e)}finally{o(null),l.w3(),d(!1),f.push("/admin/login")}},[f]),N=(0,n.useCallback)(()=>{m(null)},[]),p=(0,n.useCallback)(e=>l.CI(s,e),[s]),v=(0,n.useCallback)(e=>l.Aw(s,e),[s]);return(0,n.useEffect)(()=>{h()},[h]),(0,n.useEffect)(()=>{if(!s)return;let e=l.KE();if(e)try{let r=JSON.parse(atob(e.split(".")[1])),s=1e3*r.exp,t=Date.now(),n=s-t;n>0&&n<3e5&&(console.log("Admin token expiring soon, refreshing..."),h())}catch(e){console.error("Error parsing admin token:",e)}},[s,h]),(0,t.jsx)(i.Provider,{value:{user:s,loading:c,error:u,login:x,logout:g,clearError:N,hasRole:p,hasAnyRole:v,isAuthenticated:!!s},children:r})}function c(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAdminAuth must be used within an AdminAuthProvider");return e}function d(e,r){return function(s){let{user:l,loading:i,hasRole:o}=c(),d=(0,a.useRouter)();return((0,n.useEffect)(()=>{if(!i){if(!l){d.push("/admin/login");return}if(r&&!o(r)){d.push("/admin/unauthorized");return}}},[l,i,o,d]),i)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):l&&(!r||o(r))?(0,t.jsx)(e,{...s}):null}}},4300:function(e,r,s){"use strict";s.d(r,{$g:function(){return N},rE:function(){return p},w3:function(){return x},ZP:function(){return E},T:function(){return v},KE:function(){return f},CI:function(){return j},Aw:function(){return w},ZM:function(){return g},Wg:function(){return y}});var t,n,a,l,i,o,c,d,u=s(3464);(t=i||(i={})).SUPER_ADMIN="SUPER_ADMIN",t.PLATFORM_ADMIN="PLATFORM_ADMIN",t.SUPPORT="SUPPORT",t.DEVELOPER="DEVELOPER",(n=o||(o={})).HEALTHY="HEALTHY",n.WARNING="WARNING",n.CRITICAL="CRITICAL",n.MAINTENANCE="MAINTENANCE",(a=c||(c={})).ACTIVE="ACTIVE",a.SUSPENDED="SUSPENDED",a.PENDING="PENDING",a.CANCELLED="CANCELLED",(l=d||(d={})).STARTER="STARTER",l.BUSINESS="BUSINESS",l.ENTERPRISE="ENTERPRISE";let m=u.Z.create({baseURL:"http://localhost:3003/api",timeout:1e4,headers:{"Content-Type":"application/json"}});m.interceptors.request.use(e=>{let r=f();return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(x(),window.location.href="/admin/login"),Promise.reject(e)});let f=()=>{let e=localStorage.getItem("admin_token"),r=sessionStorage.getItem("admin_token");return e||r},h=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?localStorage.setItem("admin_token",e):sessionStorage.setItem("admin_token",e)},x=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_user"),delete m.defaults.headers.common.Authorization},g=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=JSON.stringify(e);r?localStorage.setItem("admin_user",s):sessionStorage.setItem("admin_user",s)},N=async e=>{try{let r=(await m.post("/admin/auth/login",e)).data;if(r.success){let{user:e,token:s}=r.data;return h(s,!0),g(e,!0),m.defaults.headers.common.Authorization="Bearer ".concat(s),{success:!0,message:r.message,data:{user:e,token:s}}}throw Error(r.message||"Login failed")}catch(e){var r,s;throw console.error("Admin login error:",e),Error((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||e.message||"Login failed")}},p=async()=>{try{f()&&await m.post("/admin/auth/logout")}catch(e){console.error("Admin logout error:",e)}finally{x()}},v=async()=>{try{return(await m.get("/admin/auth/profile")).data.data}catch(s){var e,r;throw console.error("Get admin profile error:",s),Error((null===(r=s.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||s.message||"Failed to get profile")}},y=async()=>{try{return(await m.get("/admin/auth/verify")).data.success}catch(e){return console.error("Admin token verification failed:",e),!1}},j=(e,r)=>!!e&&e.role===r,w=(e,r)=>!!e&&r.includes(e.role);var E=m}},function(e){e.O(0,[301,608,971,117,744],function(){return e(e.s=7794)}),_N_E=e.O()}]);
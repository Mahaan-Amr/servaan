(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{6705:function(e,r,t){Promise.resolve().then(t.bind(t,6683))},6683:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return s}});var n=t(7437),a=t(2265),o=t(9376),i=t(4540);function s(){let{user:e,loading:r}=(0,i.J3)(),t=(0,o.useRouter)();return((0,a.useEffect)(()=>{r||(e?t.push("/admin/dashboard"):t.push("/admin/login"))},[e,r,t]),r)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-admin-bg",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-admin-bg",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-admin-text",children:"در حال بارگذاری..."})]})})}},4540:function(e,r,t){"use strict";t.d(r,{J3:function(){return l},W:function(){return u},c2:function(){return c}});var n=t(7437),a=t(2265),o=t(9376),i=t(4300);let s=(0,a.createContext)(void 0);function u(e){let{children:r}=e,[t,u]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),[d,m]=(0,a.useState)(null),f=(0,o.useRouter)(),h=(0,a.useCallback)(async()=>{try{if(c(!0),!i.KE()){u(null),c(!1);return}if(!await i.Wg()){i.w3(),u(null),c(!1);return}let e=await i.T();u(e),i.ZM(e,!0)}catch(e){console.error("Admin auth check failed:",e),i.w3(),u(null)}finally{c(!1)}},[]),g=(0,a.useCallback)(async e=>{try{c(!0),m(null);let r=await i.$g(e);if(r.success)u(r.data.user),f.push("/admin/dashboard");else throw Error(r.message||"Login failed")}catch(e){throw console.error("Admin login error:",e),m(e.message||"Login failed"),e}finally{c(!1)}},[f]),E=(0,a.useCallback)(async()=>{try{c(!0),await i.rE()}catch(e){console.error("Admin logout error:",e)}finally{u(null),i.w3(),c(!1),f.push("/admin/login")}},[f]),p=(0,a.useCallback)(()=>{m(null)},[]),A=(0,a.useCallback)(e=>i.CI(t,e),[t]),N=(0,a.useCallback)(e=>i.Aw(t,e),[t]);return(0,a.useEffect)(()=>{h()},[h]),(0,a.useEffect)(()=>{if(!t)return;let e=i.KE();if(e)try{let r=JSON.parse(atob(e.split(".")[1])),t=1e3*r.exp,n=Date.now(),a=t-n;a>0&&a<3e5&&(console.log("Admin token expiring soon, refreshing..."),h())}catch(e){console.error("Error parsing admin token:",e)}},[t,h]),(0,n.jsx)(s.Provider,{value:{user:t,loading:l,error:d,login:g,logout:E,clearError:p,hasRole:A,hasAnyRole:N,isAuthenticated:!!t},children:r})}function l(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAdminAuth must be used within an AdminAuthProvider");return e}function c(e,r){return function(t){let{user:i,loading:s,hasRole:u}=l(),c=(0,o.useRouter)();return((0,a.useEffect)(()=>{if(!s){if(!i){c.push("/admin/login");return}if(r&&!u(r)){c.push("/admin/unauthorized");return}}},[i,s,u,c]),s)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):i&&(!r||u(r))?(0,n.jsx)(e,{...t}):null}}},4300:function(e,r,t){"use strict";t.d(r,{$g:function(){return p},rE:function(){return A},w3:function(){return g},ZP:function(){return b},T:function(){return N},KE:function(){return f},CI:function(){return S},Aw:function(){return I},ZM:function(){return E},Wg:function(){return v}});var n,a,o,i,s,u,l,c,d=t(3464);(n=s||(s={})).SUPER_ADMIN="SUPER_ADMIN",n.PLATFORM_ADMIN="PLATFORM_ADMIN",n.SUPPORT="SUPPORT",n.DEVELOPER="DEVELOPER",(a=u||(u={})).HEALTHY="HEALTHY",a.WARNING="WARNING",a.CRITICAL="CRITICAL",a.MAINTENANCE="MAINTENANCE",(o=l||(l={})).ACTIVE="ACTIVE",o.SUSPENDED="SUSPENDED",o.PENDING="PENDING",o.CANCELLED="CANCELLED",(i=c||(c={})).STARTER="STARTER",i.BUSINESS="BUSINESS",i.ENTERPRISE="ENTERPRISE";let m=d.Z.create({baseURL:"http://localhost:3003/api",timeout:1e4,headers:{"Content-Type":"application/json"}});m.interceptors.request.use(e=>{let r=f();return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(g(),window.location.href="/admin/login"),Promise.reject(e)});let f=()=>{let e=localStorage.getItem("admin_token"),r=sessionStorage.getItem("admin_token");return e||r},h=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?localStorage.setItem("admin_token",e):sessionStorage.setItem("admin_token",e)},g=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_user"),delete m.defaults.headers.common.Authorization},E=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=JSON.stringify(e);r?localStorage.setItem("admin_user",t):sessionStorage.setItem("admin_user",t)},p=async e=>{try{let r=(await m.post("/admin/auth/login",e)).data;if(r.success){let{user:e,token:t}=r.data;return h(t,!0),E(e,!0),m.defaults.headers.common.Authorization="Bearer ".concat(t),{success:!0,message:r.message,data:{user:e,token:t}}}throw Error(r.message||"Login failed")}catch(e){var r,t;throw console.error("Admin login error:",e),Error((null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||e.message||"Login failed")}},A=async()=>{try{f()&&await m.post("/admin/auth/logout")}catch(e){console.error("Admin logout error:",e)}finally{g()}},N=async()=>{try{return(await m.get("/admin/auth/profile")).data.data}catch(t){var e,r;throw console.error("Get admin profile error:",t),Error((null===(r=t.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||t.message||"Failed to get profile")}},v=async()=>{try{return(await m.get("/admin/auth/verify")).data.success}catch(e){return console.error("Admin token verification failed:",e),!1}},S=(e,r)=>!!e&&e.role===r,I=(e,r)=>!!e&&r.includes(e.role);var b=m}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=6705)}),_N_E=e.O()}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[902],{4540:function(e,t,r){r.d(t,{J3:function(){return u},W:function(){return l},c2:function(){return c}});var a=r(7437),n=r(2265),o=r(9376),i=r(4300);let s=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[u,c]=(0,n.useState)(!0),[d,h]=(0,n.useState)(null),m=(0,o.useRouter)(),f=(0,n.useCallback)(async()=>{try{if(c(!0),!i.KE()){l(null),c(!1);return}if(!await i.Wg()){i.w3(),l(null),c(!1);return}let e=await i.T();l(e),i.ZM(e,!0)}catch(e){console.error("Admin auth check failed:",e),i.w3(),l(null)}finally{c(!1)}},[]),g=(0,n.useCallback)(async e=>{try{c(!0),h(null);let t=await i.$g(e);if(t.success)l(t.data.user),m.push("/admin/dashboard");else throw Error(t.message||"Login failed")}catch(e){throw console.error("Admin login error:",e),h(e.message||"Login failed"),e}finally{c(!1)}},[m]),y=(0,n.useCallback)(async()=>{try{c(!0),await i.rE()}catch(e){console.error("Admin logout error:",e)}finally{l(null),i.w3(),c(!1),m.push("/admin/login")}},[m]),E=(0,n.useCallback)(()=>{h(null)},[]),S=(0,n.useCallback)(e=>i.CI(r,e),[r]),D=(0,n.useCallback)(e=>i.Aw(r,e),[r]);return(0,n.useEffect)(()=>{f()},[f]),(0,n.useEffect)(()=>{if(!r)return;let e=i.KE();if(e)try{let t=JSON.parse(atob(e.split(".")[1])),r=1e3*t.exp,a=Date.now(),n=r-a;n>0&&n<3e5&&(console.log("Admin token expiring soon, refreshing..."),f())}catch(e){console.error("Error parsing admin token:",e)}},[r,f]),(0,a.jsx)(s.Provider,{value:{user:r,loading:u,error:d,login:g,logout:y,clearError:E,hasRole:S,hasAnyRole:D,isAuthenticated:!!r},children:t})}function u(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAdminAuth must be used within an AdminAuthProvider");return e}function c(e,t){return function(r){let{user:i,loading:s,hasRole:l}=u(),c=(0,o.useRouter)();return((0,n.useEffect)(()=>{if(!s){if(!i){c.push("/admin/login");return}if(t&&!l(t)){c.push("/admin/unauthorized");return}}},[i,s,l,c]),s)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-admin-primary border-t-transparent"})}):i&&(!t||l(t))?(0,a.jsx)(e,{...r}):null}}},4300:function(e,t,r){r.d(t,{$g:function(){return E},rE:function(){return S},w3:function(){return g},ZP:function(){return v},T:function(){return D},KE:function(){return m},CI:function(){return A},Aw:function(){return w},ZM:function(){return y},Wg:function(){return p}});var a,n,o,i,s,l,u,c,d=r(3464);(a=s||(s={})).SUPER_ADMIN="SUPER_ADMIN",a.PLATFORM_ADMIN="PLATFORM_ADMIN",a.SUPPORT="SUPPORT",a.DEVELOPER="DEVELOPER",(n=l||(l={})).HEALTHY="HEALTHY",n.WARNING="WARNING",n.CRITICAL="CRITICAL",n.MAINTENANCE="MAINTENANCE",(o=u||(u={})).ACTIVE="ACTIVE",o.SUSPENDED="SUSPENDED",o.PENDING="PENDING",o.CANCELLED="CANCELLED",(i=c||(c={})).STARTER="STARTER",i.BUSINESS="BUSINESS",i.ENTERPRISE="ENTERPRISE";let h=d.Z.create({baseURL:"http://localhost:3003/api",timeout:1e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use(e=>{let t=m();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),h.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(g(),window.location.href="/admin/login"),Promise.reject(e)});let m=()=>{let e=localStorage.getItem("admin_token"),t=sessionStorage.getItem("admin_token");return e||t},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?localStorage.setItem("admin_token",e):sessionStorage.setItem("admin_token",e)},g=()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_user"),delete h.defaults.headers.common.Authorization},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=JSON.stringify(e);t?localStorage.setItem("admin_user",r):sessionStorage.setItem("admin_user",r)},E=async e=>{try{let t=(await h.post("/admin/auth/login",e)).data;if(t.success){let{user:e,token:r}=t.data;return f(r,!0),y(e,!0),h.defaults.headers.common.Authorization="Bearer ".concat(r),{success:!0,message:t.message,data:{user:e,token:r}}}throw Error(t.message||"Login failed")}catch(e){var t,r;throw console.error("Admin login error:",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||e.message||"Login failed")}},S=async()=>{try{m()&&await h.post("/admin/auth/logout")}catch(e){console.error("Admin logout error:",e)}finally{g()}},D=async()=>{try{return(await h.get("/admin/auth/profile")).data.data}catch(r){var e,t;throw console.error("Get admin profile error:",r),Error((null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||r.message||"Failed to get profile")}},p=async()=>{try{return(await h.get("/admin/auth/verify")).data.success}catch(e){return console.error("Admin token verification failed:",e),!1}},A=(e,t)=>!!e&&e.role===t,w=(e,t)=>!!e&&t.includes(e.role);var v=h},4607:function(e,t,r){r.d(t,{cp:function(){return c},sT:function(){return d}});var a=r(2093),n=r(5710),o=r(936),i=r(1921),s=r(6246),l=r(6619);class u{toPersian(){try{switch(this.options.format){case"jalali":return(0,s.WU)(this.date,"yyyy/MM/dd HH:mm");case"long":return(0,s.WU)(this.date,"EEEE d MMMM yyyy HH:mm",{locale:i.T});case"relative":return(0,l.Q)(this.date,{addSuffix:!0,locale:i.T});default:return(0,s.WU)(this.date,"yyyy/MM/dd")}}catch(e){return console.error("Error formatting Persian date:",e),this.date.toLocaleDateString("fa-IR")}}toGregorian(){try{switch(this.options.format){case"long":return(0,a.WU)(this.date,"EEEE, MMMM d, yyyy HH:mm",{locale:i.T});case"relative":return(0,n.Q)(this.date,{addSuffix:!0,locale:i.T});default:return(0,a.WU)(this.date,"yyyy/MM/dd")}}catch(e){return console.error("Error formatting Gregorian date:",e),this.date.toLocaleDateString("en-US")}}format(){return"fa"===this.options.locale?this.toPersian():this.toGregorian()}getRelativeTime(){try{if("fa"===this.options.locale)return(0,l.Q)(this.date,{addSuffix:!0,locale:i.T});return(0,n.Q)(this.date,{addSuffix:!0,locale:i.T})}catch(e){return console.error("Error getting relative time:",e),this.date.toLocaleDateString()}}getTime(){try{return(0,a.WU)(this.date,"HH:mm:ss")}catch(e){return console.error("Error formatting time:",e),this.date.toLocaleTimeString()}}getDayOfWeek(){try{return({fa:["یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]})[this.options.locale||"fa"][this.date.getDay()]}catch(e){return console.error("Error getting day of week:",e),""}}getMonthName(){try{let e={fa:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]},t=this.options.locale||"fa";if("fa"!==t)return e.en[this.date.getMonth()];{let t=this.toJalaliDate();return e.fa[t.month-1]}}catch(e){return console.error("Error getting month name:",e),""}}toJalaliDate(){try{let e=this.date.getFullYear(),t=this.date.getMonth()+1,r=this.date.getDate(),a=e-621,n=t+2;return n>12&&(n-=12,a+=1),{year:a,month:n,day:r+1}}catch(e){return console.error("Error converting to Jalali:",e),{year:0,month:0,day:0}}}isToday(){let e=new Date;return this.date.toDateString()===e.toDateString()}isYesterday(){let e=new Date;return e.setDate(e.getDate()-1),this.date.toDateString()===e.toDateString()}isThisWeek(){let e=new Date,t=new Date(e);t.setDate(e.getDate()-e.getDay());let r=new Date(t);return r.setDate(t.getDate()+6),this.date>=t&&this.date<=r}isThisMonth(){let e=new Date;return this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}isThisYear(){let e=new Date;return this.date.getFullYear()===e.getFullYear()}constructor(e,t={}){this.date="string"==typeof e?(0,o.D)(e):new Date(e),this.options={locale:"fa",format:"short",timezone:"Asia/Tehran",...t}}}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new u(e,t).format()},d=()=>{let e=new Date;return(0,a.WU)(e,"HH:mm:ss")}}}]);